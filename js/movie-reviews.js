initialMovieData=[];completeMovieSearch=[];completeMovieSearchIDs=[];completeMovieData=[];searchResultIndexes=[];numTotalMovies=0;numMoviesShowing=0;sampleChain="";sampleEmptyStar="";sampleFullStar="";sampleHalfStar="";pageSize=10;currentlySearching=false;addEvent(window,"load",function(){initSVGIconsHTML();initSearchBox();initMovieRendering();initMovieSearchList(initSearchResultIndexes);initCompleteMovieData(initSearchResultIndexes);addEvent(document.getElementById("search"),"keyup",movieSearchChanged);addEvent(document.getElementById("sortBy"),"change",movieSearchChanged);addEvent(document.getElementById("reviewsArea"),"click",loadFullReview);addEvent(document.getElementById("showAllMovies"),"click",showAllMovies);addEvent(document.getElementById("reviewsArea"),"click",linkTo1Movie);var b=0;var a=false;addEvent(window,"scroll",function(c){b=window.scrollY;if(a){return}setTimeout(function(){positionMoviesCounter();infiniteLoader();a=false},200);a=true})});function initSearchBox(){if(window.location.hash.length>0){searchBoxMode("show-all-button")}else{searchBoxMode("search-fields")}}function initMovieRendering(){if(window.location.hash.length>0){var a=window.location.hash.replace("#!","");var c=function(){if(completeMovieSearch.length==0||completeMovieData.length==0){return}var d=movieID2Index(a);if(d<0){location.href=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname;return}searchResultIndexes=[d];var e=completeMovieData[d];loading("off");numMoviesShowing=1,numTotalMovies=completeMovieSearch.length;currentlySearching=false;renderMovieCount();document.getElementById("reviewsArea").innerHTML=getMovieHTML(e)};initCompleteMovieData(c);initMovieSearchList(c)}else{var b=function(){if(completeMovieSearch.length==0||initialMovieData.length==0){return}numTotalMovies=completeMovieSearch.length;currentlySearching=false;renderMovieCount()};initMovieSearchList(b);renderInitialMovieData(b)}}function initSVGIconsHTML(){sampleChain=document.querySelector(".sample .icon-chain").outerHTML;sampleEmptyStar=document.querySelector(".sample .icon-star-o").outerHTML;sampleFullStar=document.querySelector(".sample .icon-star").outerHTML;sampleHalfStar=document.querySelector(".sample .icon-star-half-empty").outerHTML}var gettingInitialMovieData=false;function renderInitialMovieData(a){if(initialMovieData.length>0){return a()}addEvent(document,"got-initial-movie-data",a);if(gettingInitialMovieData){return}gettingInitialMovieData=true;ajax(siteGlobals.moviesInitListJSON,function(c){try{initialMovieData=JSON.parse(c);var e="";for(var b=0;b<initialMovieData.length;b++){e+=getMovieHTML(initialMovieData[b])}loading("off");numMoviesShowing=initialMovieData.length;document.getElementById("reviewsArea").innerHTML=e;triggerEvent(document,"got-initial-movie-data")}catch(d){console.log("error in initInitialMovieData function: "+d);gettingInitialMovieData=false}})}function linkTo1Movie(c){var a=c.target;if((a.tagName=="a")&&inArray("link",a.className)){var b=a.parentNode}else{if((a.tagName=="svg")&&inArray("icon-chain",a.outerHTML)){var b=a.parentNode.parentNode}else{if((a.tagName=="use")&&inArray("icon-chain",a.outerHTML)){var b=a.parentNode.parentNode.parentNode}else{return}}}currentlySearching=false;numMoviesShowing=1;renderMovieCount();document.getElementById("reviewsArea").innerHTML=b.outerHTML;searchBoxMode("show-all-button");document.getElementById("search").value=""}function showAllMovies(){window.location.hash="";searchBoxMode("search-fields");var a=document.getElementById("search");a.value="";document.getElementById("sortBy").value="highest-rating";triggerEvent(a,"keyup")}var loadingStatus="on";function loading(a){switch(a){case"on":document.getElementById("movieLoaderArea").style.display="block";loadingStatus="on";break;case"off":document.getElementById("movieLoaderArea").style.display="none";loadingStatus="off";break}}function getMovieHTML(f){var c=(f.title+f.year).toLowerCase().replace(/[^a-z0-9]*/g,"");var d=(f.hasOwnProperty("titleAndYear")?f.titleAndYear:f.title+" ("+f.year+")");var b='<button class="load-review" id="load-'+c+'">load review</button><br><span class="review-explanation">(this review '+(f.spoilers?"contains":"has no")+" spoilers)</span>";var a=f.hasOwnProperty("review")?"<p>"+f.review.replace(/\n/g,"<br><br>")+"</p>":b;var e=siteGlobals.siteURL+"/img/movie-thumbnail-"+c+".jpg?hash="+f.thumbnailHash;return'<div class="movie" id="!'+c+'"><a class="link" href="'+siteGlobals.siteURL+"/movie-reviews/#!"+c+'" title="right click and copy link for the URL of this movie review">'+sampleChain+'</a><div class="thumbnail-and-stars"><a href="https://www.imdb.com/title/'+f.IMDBID+'/"><img src="'+e+'" alt="movie thumbnail"></a><div class="stars">'+getMovieStarsHTML(f.rating)+'</div></div><h3 class="movie-title">'+d+'</h3><h4 class="review-title">'+f.reviewTitle+'</h4><div class="review-text">'+a+"</div></div>"}function loadFullReview(c){if(typeof c.target.className!="string"){return}if(!inArray("load-review",c.target.className)){return}var b=c.target.id.replace("load-","");var a=movieID2Index(b);if(completeMovieData[a].hasOwnProperty("review")){c.target.parentNode.innerHTML="<p>"+completeMovieData[a].review.replace(/\n/g,"<br><br>")+"</p>";return}ajax("/json/movie-review-"+b+".json?hash="+completeMovieData[a].reviewHash,function(d){try{var f=JSON.parse(d).reviewFull;c.target.parentNode.innerHTML="<p>"+f.replace(/\n/g,"<br><br>")+"</p>";completeMovieData[a].review=f}catch(e){console.log("error in loadFullReview function: "+e)}})}function getMovieStarsHTML(c){var b="";for(var a=1;a<=5;a++){if(a<=c){b+=sampleFullStar}else{if((a-1)<c){b+=sampleHalfStar}else{b+=sampleEmptyStar}}}return b}function highlightSearch(a,b){foreach(a,function(d,c){var e=new RegExp("("+c+")","i");b=b.replace(e,"<u>$1</u>")});return b}function searchBoxMode(b){var d=document.getElementById("searchBox");var c=document.getElementById("showAllMovies");var a=d.parentNode;switch(b){case"show-all-button":d.style.display="none";c.style.display="inline-block";a.style.textAlign="center";break;case"search-fields":c.style.display="none";d.style.display="block";a.style.textAlign="start";break}}function renderMovieCount(){if(numTotalMovies==0){document.getElementById("xOfYMoviesCount").style.display="none";document.getElementById("noMoviesCount").style.display="inline"}else{document.getElementById("noMoviesCount").style.display="none";document.getElementById("xOfYMoviesCount").style.display="inline";document.getElementById("numMoviesShowing").innerHTML=numMoviesShowing;document.getElementById("totalMoviesFound").innerHTML=numTotalMovies;document.getElementById("searchTypeDescription").innerHTML=(currentlySearching?"search results":"total movies")}}var currentMovieCountPanelPosition="inline";function positionMovieCountPanel(b){if(b==currentMovieCountPanelPosition){return}switch(b){case"fixed":case"inline":break;default:return}var a=document.getElementById("movieCountPanel");switch(b){case"fixed":a.style.width=a.offsetWidth+"px";a.style.top=0;a.style.position="fixed";break;case"inline":a.style.position="static";a.style.width="100%";break}currentMovieCountPanelPosition=b}function positionMoviesCounter(){var a=document.getElementsByClassName("movie-count-area")[0];positionMovieCountPanel(isScrolledTo(a,"above")?"fixed":"inline")}function infiniteLoader(){if(loadingStatus=="on"){return}if(window.location.hash.length>0){return}var a=document.getElementsByTagName("footer")[0];if(!isScrolledTo(a,"view","partially")){return}renderMoreMovies()}function renderMoreMovies(){if(numMoviesShowing>=searchResultIndexes.length){return}loading("on");var c=document.createElement("div");c.className="moreMovieReviews";var f=numMoviesShowing;var d="";for(var b=0;b<pageSize;b++){if(f>=searchResultIndexes.length){break}var a=searchResultIndexes[f];var e=completeMovieData[a];d+=getMovieHTML(e);f++}c.innerHTML=d;numMoviesShowing+=b;setTimeout(function(){document.getElementById("reviewsArea").appendChild(c);renderMovieCount();loading("off")},1000)}var gettingMovieSearchList=false;function initMovieSearchList(a){if(completeMovieSearch.length>0){return a()}addEvent(document,"got-movie-search-list",a);if(gettingMovieSearchList){return}gettingMovieSearchList=true;ajax(siteGlobals.moviesSearchIndexJSON,function(c){try{completeMovieSearch=JSON.parse(c);completeMovieSearchIDs=new Array(completeMovieSearch.length);for(var b=0;b<completeMovieSearch.length;b++){completeMovieSearchIDs[b]=completeMovieSearch[b].replace(/[^a-z0-9]*/g,"")}triggerEvent(document,"got-movie-search-list")}catch(d){console.log("error in initMovieSearchList function: "+d);gettingMovieSearchList=false}})}function movieID2Index(a){return completeMovieSearchIDs.indexOf(a)}function initSearchResultIndexes(){if(completeMovieSearch.length==0||completeMovieData.length==0){return}generateSortedData("")}function generateSortedData(d){searchResultIndexes=searchMovieTitles(d);var c=[];for(var b=0;b<searchResultIndexes.length;b++){var a=searchResultIndexes[b];var e=jsonCopyObject(completeMovieData[a]);e.index=a;c.push(e)}c=sortMovies(c);for(var b=0;b<searchResultIndexes.length;b++){searchResultIndexes[b]=c[b]["index"]}return c}function movieSearchChanged(){document.getElementById("reviewsArea").innerHTML="";loading("on");var b=trim(document.getElementById("search").value).toLowerCase();var a=extractSearchTerms(b);var c=function(){if(completeMovieSearch.length==0||completeMovieData.length==0){return}var e=generateSortedData(a);if(b==""){numMoviesShowing=completeMovieSearch.length;if(numMoviesShowing>pageSize){numMoviesShowing=pageSize}numTotalMovies=completeMovieSearch.length;currentlySearching=false;renderMovieCount()}else{numMoviesShowing=searchResultIndexes.length;if(numMoviesShowing>pageSize){numMoviesShowing=pageSize}numTotalMovies=searchResultIndexes.length;currentlySearching=true;renderMovieCount()}var f="";for(var d=0;d<numMoviesShowing;d++){var g=e[d];g.titleAndYear=highlightSearch(a,g.title+" ("+g.year+")");f+=getMovieHTML(g)}loading("off");document.getElementById("reviewsArea").innerHTML=f};initMovieSearchList(c);initCompleteMovieData(c)}function extractSearchTerms(a){if(a==""){return[]}return a.split(/[^a-z0-9]/gi).map(function(b){return b.toLowerCase()}).filter(function(c,b,d){if(c==""){return false}return d.indexOf(c)===b})}function searchMovieTitles(c){if(c.length==0){b=new Array(completeMovieSearch.length);for(var a=0;a<completeMovieSearch.length;a++){b[a]=a}return b}var b=[];foreach(completeMovieSearch,function(d,e){var f=false;foreach(c,function(g,h){if(!inArray(h,e)){f=true;return false}});if(!f&&!inArray(d,b)){b.push(d)}});return b}var gettingCompleteMovieData=false;function initCompleteMovieData(a){if(completeMovieData.length>0){return a()}addEvent(document,"got-complete-movie-data",a);if(gettingCompleteMovieData){return}gettingCompleteMovieData=true;ajax(siteGlobals.moviesListJSON,function(b){try{completeMovieData=JSON.parse(b);triggerEvent(document,"got-complete-movie-data")}catch(c){console.log("error in initCompleteMovieData function: "+c);gettingCompleteMovieData=false}})}function sortMovies(a){if(a.length==0){return[]}var b=document.getElementById("sortBy").value;switch(b){case"newest-reviews":return a.reverse();case"oldest-reviews":return a}a.sort(function(d,c){var g=0;var f=d.title.toLowerCase();var e=c.title.toLowerCase();switch(b){case"highest-rating":case"lowest-rating":if(d.rating==c.rating){if(f>e){g=1}else{if(f<e){g=-1}}}else{if(d.rating>c.rating){g=1}else{if(d.rating<c.rating){g=-1}}if(b=="highest-rating"){g*=-1}}break;case"title-ascending":case"title-descending":if(f>e){g=1}else{if(f<e){g=-1}}if(b=="title-descending"){g*=-1}break}return g});return a};