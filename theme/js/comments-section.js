siteGlobals.loadedCommentsPlatforms=[];addEvent(window,"load",function(){foreach(siteGlobals.commentsPlatforms,function(c,a){var b=".comment-with."+a.toLowerCase();foreach(document.querySelectorAll(b),function(d,e){addEvent(e,"click",function(f){renderComments(a)})});foreach(document.querySelectorAll(b+" span"),function(d,e){addEvent(e,"click",function(f){renderComments(a)})})});addEvent(document.getElementById("exitComments"),"click",exitComments)});var spacerTopPos=0;var commentsTopPos=0;var timeoutIDResizeBottomSpacer;function repositionCommentsContainer(a){closeMenu();spacerTopPos=getCoordinates(document.querySelector("article .bottom-spacer")).top;document.querySelector("article .bottom-spacer").style.height="0px";var c=document.querySelector(".comments");c.style.display="block";var b=window.pageYOffset+60;c.style.top=b+"px";commentsTopPos=b;timeoutIDResizeBottomSpacer=setInterval(function(){resizeBottomSpacerHeight(a)},200)}function renderComments(a){repositionCommentsContainer(a);if(siteGlobals.events.loadingCommentsPlatform!=null){return}siteGlobals.events.loadingCommentsPlatform=a;foreach(siteGlobals.commentsPlatforms,function(b,e){var d=document.querySelectorAll(".comment-with."+e.toLowerCase());var c=document.querySelector("."+e.toLowerCase()+"-comments");if(a==e){c.style.display="block"}else{c.style.display="none"}foreach(d,function(g,f){if(a==e){f.classList.add("selected")}else{f.classList.remove("selected");f.classList.add("disallow-selection")}})});foreach(document.querySelectorAll(".platform-offline"),function(b,c){c.style.display="none"});if(inArray(a,siteGlobals.loadedCommentsPlatforms)){return commentsLoaded()}window["load"+a+"Platform"]()}function exitComments(){if(siteGlobals.events.loadingCommentsPlatform!=null){return}clearInterval(timeoutIDResizeBottomSpacer);document.querySelector(".comments").style.display="none";foreach(document.querySelectorAll(".comment-with"),function(a,b){b.classList.remove("disallow-selection");b.classList.remove("selected")});document.querySelector("article .bottom-spacer").style.height="0px"}function resizeBottomSpacerHeight(a){var f=document.querySelector(".comments");var d=commentsTopPos+f.offsetHeight;var c=getCoordinates(document.querySelector("footer")).top;var g=30;var b=c-g-d;if(inArray(a,siteGlobals.loadedCommentsPlatforms)){clearInterval(timeoutIDResizeBottomSpacer)}if(Math.abs(b)<=0){return}var e=document.querySelector("article .bottom-spacer");if(spacerTopPos>d){e.style.height="0px"}else{e.style.height=(e.offsetHeight-b)+"px"}}function commentsLoaded(){foreach(document.querySelectorAll(".comment-with"),function(a,b){b.classList.remove("disallow-selection")});siteGlobals.events.loadingCommentsPlatform=null}function platformOffline(){foreach(document.querySelectorAll(".comment-with"),function(a,b){b.classList.remove("disallow-selection")});siteGlobals.events.loadingCommentsPlatform=null}window.fbAsyncInit=function(){FB.init({appId:siteGlobals.facebookAppID,cookie:true,xfbml:true,version:"v3.0"});FB.AppEvents.logPageView();FB.Event.subscribe("xfbml.render",fbRendered);FB.Event.subscribe("comment.create",fbUpdateCommentCount);FB.Event.subscribe("comment.remove",fbUpdateCommentCount)};function loadFBPlatform(){document.querySelector(".platform-comments-loader.faceboook").style.display="block";siteGlobals.events.fbCommentsLoadingTimer=setTimeout(fbOffline,15*1000);(function(e,a,f){var c,b=e.getElementsByTagName(a)[0];if(e.getElementById(f)){return}c=e.createElement(a);c.id=f;c.src="https://connect.facebook.net/en_US/sdk.js?nocache="+unixtime();b.parentNode.insertBefore(c,b)}(document,"script","facebook-jssdk"))}function fbOffline(){document.querySelector(".platform-offline.faceboook").style.display="block";document.querySelector(".platform-comments-loader.faceboook").style.display="none";deleteElementById("facebook-jssdk");platformOffline()}function fbRendered(a){siteGlobals.loadedCommentsPlatforms.push("FB");clearTimeout(siteGlobals.events.fbCommentsLoadingTimer);document.querySelector(".platform-offline.faceboook").style.display="none";document.querySelector(".platform-comments-loader.faceboook").style.display="none";commentsLoaded()}function fbUpdateCommentCount(){ajax("https://graph.facebook.com/v2.1/"+encodeURIComponent(siteGlobals.siteURL+"/"+siteGlobals.article.url)+"?fields=share&method=get&pretty=0&sdk=joey&suppress_http_code=1",function(a){try{document.querySelector(".fb-comment-count").innerHTML=JSON.parse(a).share.comment_count}catch(b){}})}fbUpdateCommentCount();addEvent(window,"load",resetDisqusComments);var disqus_config=function(){if(siteGlobals.siteURL!=""){this.page.url=siteGlobals.siteURL+"/"+siteGlobals.article.url}this.page.identifier=siteGlobals.article.title;this.page.sortOrder="newest";this.callbacks.onReady=[disqusReady];this.callbacks.onNewComment=[disqusCommentUpdated]};function resetDisqusComments(){document.getElementById("disqus_thread").innerHTML=document.getElementById("disqusCommentsSilo").innerHTML}function loadDisqusPlatform(){document.querySelector(".disqus-comments .platform-comments-loader").style.display="block";document.querySelector(".disqus-comments").style.marginBottom="50px";siteGlobals.events.disqusCommentsLoadingTimer=setTimeout(disqusOffline,15*1000);siteGlobals.events.disqusCommentsLoadingInterval=setInterval(cleanDisqusLoaders,0.5*1000);(function(){var b=document,a=b.createElement("script");a.src="https://"+siteGlobals.disqusSiteName+".disqus.com/embed.js";a.id="disqus-script";a.setAttribute("data-timestamp",+new Date());(b.head||b.body).appendChild(a)})()}function disqusOffline(){clearInterval(siteGlobals.events.disqusCommentsLoadingInterval);resetDisqusComments();document.querySelector(".disqus-comments .platform-offline").style.display="block";document.querySelector(".disqus-comments .platform-comments-loader").style.display="none";deleteElementById("disqus-script");platformOffline()}function cleanDisqusLoaders(){if(enforceOneDisqusLoader()){clearInterval(siteGlobals.events.disqusCommentsLoadingInterval)}}function enforceOneDisqusLoader(){var c=false;var a=false;var b=false;var d;foreach(document.getElementById("disqus_thread").children,function(e,f){if(f.tagName=="IFRAME"){b=true}if(f.tagName=="DIV"&&inArray("platform-comments-loader",f.className)){d=f;a=true}if(b&&a){deleteElement(d);return false}});return(b&&a)}function disqusCommentUpdated(a){DISQUSWIDGETS.getCount({reset:true})}function disqusReady(a){siteGlobals.loadedCommentsPlatforms.push("Disqus");clearTimeout(siteGlobals.events.disqusCommentsLoadingTimer);clearInterval(siteGlobals.events.disqusCommentsLoadingInterval);document.querySelector(".disqus-comments").style.marginBottom="0px";try{document.querySelector(".disqus-comments .platform-offline").style.display="none";document.querySelector(".disqus-comments .platform-comments-loader").style.display="none"}catch(b){}commentsLoaded()}function disqusUpdateCommentCount(){ajax("https://cors-anywhere.herokuapp.com/https://"+siteGlobals.disqusSiteName+".disqus.com/count-data.js?1="+encodeURIComponent(siteGlobals.article.title)+"&nocache="+unixtime(),function(a){try{var d=a.match(/DISQUSWIDGETS.displayCount\((.*)\)/i);var b=d[1];document.querySelector(".disqus-comment-count").innerHTML=JSON.parse(b).counts[0].comments}catch(c){}})}disqusUpdateCommentCount();