<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>how does bitcoin mining work?</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="description" content="An interactive walkthrough of bitcoin mining. No prior knowledge is necessary."/>
        <meta name="author" content="peter miller"/>

        <meta property="og:site_name" content="analysis"/>
        <meta property="og:title" content="how does bitcoin mining work?"/>
        <meta property="og:type" content="article"/>
        <meta property="og:url" content="http://null.place/drafts/how-does-bitcoin-mining-work.html"/>
        <meta property="og:image" content="http://null.place/theme/img/shattered-glass-matrix.png"/>
        <meta property="og:image:width" content="266"/>
        <meta property="og:image:height" content="266"/>
        <meta property="og:description" content="An interactive walkthrough of bitcoin mining. No prior knowledge is necessary."/>
        <meta property="fb:app_id" content="2040066019560327"/>

        <meta itemprop="name" content="analysis"/>
        <meta itemprop="description" content="An interactive walkthrough of bitcoin mining. No prior knowledge is necessary."/>
        <meta itemprop="image" content="http://null.place/theme/img/shattered-glass-matrix.png"/>


        <link rel="stylesheet" href="http://null.place/theme/css/thematrix.css"/>
        <link rel="stylesheet" href="http://null.place/css/btc.css"/>

        <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
        <![endif]-->

        <link rel="shortcut icon" href="http://null.place/theme/img/favicon.ico" type="image/x-icon"/>
        <link rel="icon" href="http://null.place/theme/img/favicon.ico" type="image/x-icon"/>
        <link rel="apple-touch-icon" href="http://null.place/theme/img/apple-touch-icon.png"/>
        <link rel="apple-touch-icon" sizes="72x72" href="http://null.place/theme/img/apple-touch-icon-72x72.png"/>
        <link rel="apple-touch-icon" sizes="114x114" href="http://null.place/theme/img/apple-touch-icon-114x114.png"/>

        <link href="http://null.place/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="analysis ATOM Feed"/>
        <link href="http://null.place/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="analysis RSS Feed"/>
    </head>

    <body>
        <div id="fullpagePopupNotification" class="popup-fullpage" style="display:none;">
            <span class="popup-centerer">
                <h1><span id="fullpagePopupHeading"></span></h1><br>
                <span id="fullpagePopupDetail"></span>
            </span>
        </div>
        <div class="top-bar hidden-pc">
            <a class="brand" href="http://null.place/">analysis</a>
<div class="logo-container">
    <div class="logo-positioner">
        <div class="logo-cropper">
            <canvas class="matrix-text-green"></canvas>
            <canvas class="matrix-text-white"></canvas>
            <img src="http://null.place/theme/img/shattered-glass-2b.png" id="logo_img" alt="website logo">
        </div>
        <div class="logo-hide-border-artifacts"></div>
    </div>
</div>            <button id="btnNavbar" menu-is-collapsed="true">
                <i class="fa fa-bars" aria-hidden="true"></i>
            </button>
            <div id="navMenu" class="nav-menu-phone">
<ul class="nav-menu">
    <a href="http://null.place/example-category-a/" >
        <i class="fa fa-folder-open-o" aria-hidden="true"></i> example category a<sup> 3</sup>
    </a>
    <a href="http://null.place/example-category-b/" >
        <i class="fa fa-folder-open-o" aria-hidden="true"></i> example category b<sup> 3</sup>
    </a>
    <a href="http://null.place/archives/" >
        <i class="fa fa-book" aria-hidden="true"></i> all<sup>&nbsp;</sup>
    </a>
    <a href="http://null.place/tags/" >
        <i class="fa fa-hashtag" aria-hidden="true"></i> all<sup>&nbsp;</sup>
    </a>
</ul>            </div>
        </div>

        <div class="container">
            <div class="col-2">                <div class="side-bar">
                    <a class="brand" href="http://null.place/">analysis</a>
<ul class="nav-menu">
    <a href="http://null.place/example-category-a/" >
        <i class="fa fa-folder-open-o" aria-hidden="true"></i> example category a<sup> 3</sup>
    </a>
    <a href="http://null.place/example-category-b/" >
        <i class="fa fa-folder-open-o" aria-hidden="true"></i> example category b<sup> 3</sup>
    </a>
    <a href="http://null.place/archives/" >
        <i class="fa fa-book" aria-hidden="true"></i> all<sup>&nbsp;</sup>
    </a>
    <a href="http://null.place/tags/" >
        <i class="fa fa-hashtag" aria-hidden="true"></i> all<sup>&nbsp;</sup>
    </a>
</ul>                </div>
<div class="logo-container">
    <div class="logo-positioner">
        <div class="logo-cropper">
            <canvas class="matrix-text-green"></canvas>
            <canvas class="matrix-text-white"></canvas>
            <img src="http://null.place/theme/img/shattered-glass-black.png" id="logo_img" alt="website logo">
        </div>
        <div class="logo-hide-border-artifacts"></div>
    </div>
</div>            </div>
            <div class="col-1">
<section id="content">
        <article>
                <header>
                        <h1>
                            how does bitcoin mining work?
                        </h1>
                </header>
                <div class="entry-content">
                <div class="info-box">

<a href="http://null.place/cryptocurrencies/"><i class="fa fa-folder-open-o" aria-hidden="true"></i> cryptocurrencies</a>

(<abbr class="published" title="2017-11-28T00:00:00+10:30">2017-11-28</abbr>)


	<span class="keep-together"><a href="http://null.place/tag/bitcoin/"><i class="fa fa-hashtag" aria-hidden="true"></i>bitcoin</a></span>
	<span class="keep-together"><a href="http://null.place/tag/mining/"><i class="fa fa-hashtag" aria-hidden="true"></i>mining</a></span>
	<span class="keep-together"><a href="http://null.place/tag/proof-of-work/"><i class="fa fa-hashtag" aria-hidden="true"></i>proof-of-work</a></span>
                </div>
                <p>This article is for people who want to understand the inner workings of bitcoin
mining. I have made it interactive so that you can simulate the mining algorithms
for yourself and get a feel for how mining really works. While the concepts here
are not simple, they should be easily accessible to an interested layperson. And
I hope the interacivity will make an otherwise dry subject fun.</p>
<h2>cryptographic hashing</h2>
<p>To understand bitcoin mining, it is first necessary to understand what
cryptographic hashing is and how it works. Rather than bore you with definitions
at the start, lets just dive in and give it a go. Click the <em>SHA256</em> button
a few times and then try typing different things in the <em>pre-image</em> field:
<div class="form-container" id="form0">
    <label for="inputMessage0" class="for-textbox">pre-image</label><br>
    <div class="left">
        <input id="inputMessage0" type="text" value="hello world!">
    </div>
    <div class="left">
        <button id="btnRunHash0">SHA256</button>
    </div>
    <br>
    <div class="left">
        <span id="hash0Duration"></span>
    </div>
    <div class="codeblock-container auto-wrap-on-mobile" style="display:none;">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div id="hash0Results" class="codeblock"></div>
    </div>
</div></p>
<p><em>SHA256</em> stands for <em>Secure Hash Algorithm (256 bits)</em>. There are many different
hashing algorithms - <em>SHA128</em>, <em>SHA512</em>, <em>MD5</em>, <em>RIPEMD128</em>, <em>RIPEMD160</em>, etc.
The differences between these hashing algorithms are not important for the sake
of this article - all that is important is to recognise that <em>SHA256</em> is merely
one of many hashing algorithms - the one that is used in bitcoin mining (more on
that soon). The output of a cryptographic hash is actually a number, however
that may not have been obvious when you ran the <em>SHA256</em> hash above, since that
number is written in hexadecimal format - i.e. base 16. To explain what that
means, here are some hexadecimal values side by side with their decimal
equivalent values:</p>
<div class="horizontal-center">
<pre>
hex 0 = dec 0
hex 1 = dec 1
hex 2 = dec 2
hex 3 = dec 3
hex 4 = dec 4
hex 5 = dec 5
hex 6 = dec 6
hex 7 = dec 7
hex 8 = dec 8
hex 9 = dec 9
hex a = dec 10
hex b = dec 11
hex c = dec 12
hex d = dec 13
hex e = dec 14
hex f = dec 15
</pre>
<pre>
hex 10 = dec 16
hex 11 = dec 17
hex 12 = dec 18
hex 13 = dec 19
hex 14 = dec 20
hex 15 = dec 21
hex 16 = dec 22
hex 17 = dec 23
hex 18 = dec 24
hex 19 = dec 25
hex 1a = dec 26
hex 1b = dec 27
hex 1c = dec 28
hex 1d = dec 29
hex 1e = dec 30
hex 1f = dec 31
</pre>
</div>

<p>Don't worry, you won't need to do any hexadecimal conversions in this article.
All you need to remember here is that hexadecimal digits go from <code>0</code> to <code>9</code> to
<code>a</code> to <code>f</code>.</p>
<p>OK, so now that you have tried cryptographic hashing, and you know about
hexadecimal format, lets have a look at the formal definition of cryptographic
hashing:</p>
<blockquote>
<p>Cryptographic hashing involves taking a string of characters and transforming
them into another string of characters. We call the initial characters the
<i>pre-image</i> and we call the output the <i>hash</i>.</p>
<p></p>
<p>A cryptographic hashing algorithm has the following properties relevant to
bitcoin mining:</p>
<p></p>
<ol>
    <li>it is deterministic - the same pre-image always results in the same hash</li>
    <li>it is quick to compute the hash value for any given pre-image</li>
    <li>it is impossible to reverse a cryptographic hash and recover a pre-image
    from its hash value, except by trying all possible pre-images</li>
    <li>a small change to a pre-image changes the hash value so extensively
    that the new hash value appears uncorrelated with the old hash value</li>
</ol>
</blockquote>

<p>Lets investigate these properties. Properties 1 and 2 are quite obvious - earlier
when we hashed <code>hello world!</code> with <em>SHA256</em> it always gave
<code>7509e5bda0c762d2bac7f90d758b5b2263fa01ccbc542ab5e3df163be08e6ca9</code> and took
<span id="helloWorldHashSpeed">less than 4 milliseconds (depending on the speed
of your device)</span>, which is fairly quick. However it must be noted that
performing the hash always takes at least <em>some</em> time, even if it is a very small
amount of time. This fact will be important when we discuss hashing in relation
to bitcoin mining later on.</p>
<p>Property 3 explains that hashing is a one-way process. We can easily get from
a pre-image to its hash, but it is impossible to programatically get from a
cryptographic hash back to its pre-image. The process of trying to get from a
hash back to its pre-image is called <em>inverting the hash</em>.</p>
<div class="codeblock">easy:       pre-image -> SHA256 -> hash

impossible: pre-image <- SHA256 <- hash
</div>

<p>If we start with a pre-image and then hash it, then of course we will know what
the pre-image for the resulting hash is - for example, if I give you the hash
<code>7509e5bda0c762d2bac7f90d758b5b2263fa01ccbc542ab5e3df163be08e6ca9</code> then you
already know that a corresponding SHA256 pre-image is <code>hello world!</code>, since we
already hashed <code>hello world!</code> with SHA256 earlier and it gave this result. But
if I give you <code>32bd2fb75ea9fdd49c0a9b97b015b47a9cf41f6fc2f773dde97c67bcfc9830c7</code>
then you will not be able to find the pre-image which results in this hash - i.e.
you will not be able to invert this hash. Seriously - give it a go:</p>
<div class="form-container" id="form1">
    <input type="checkbox" id="inputCheckbox1" checked>
    <label for="inputCheckbox1">automatically increment pre-image after each hash</label>
    <br><br>
    <label for="inputMessage1" class="for-textbox">pre-image</label><br>
    <div class="left">
        <input id="inputMessage1" type="text" value="a">
    </div>
    <div class="left">
        <button id="btnRunHash1">SHA256</button>
    </div>
    <br>
    <div class="left">
        <span id="info1" style="display:none;">
            (Average hash rate: <span></span> hashes per second)
        </span>
    </div>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div id="codeblock1HashResults" class="codeblock">? <span class="aligner"></span>-> SHA256 -> <span id="match1" class="individual-digits">32bd2fb75ea9fdd49c0a9b97b015b47a9cf41f6fc2f773dde97c67bcfc9830c7</span>
<span id="showResults1" style="display:none;"><span id="preImage1"></span> <span class="aligner"></span>-> SHA256 -> <span id="hash1Result" class="individual-digits"></span>
status: <span id="matchStatus1"></span></span></div>
    </div>
</div>

<p>The difficulty of inverting a <em>SHA256</em> hash is due its length being so large!
<em>SHA256</em> has 2<sup>256</sup> possible different hash values. That's
115792089237316195423570985008687907853269984665640564039457584007913129639936
different possible hash values. There are approximately that many atoms in the
universe! So don't feel bad for not being able to invert
<code>32bd2fb75ea9fdd49c0a9b97b015b47a9cf41f6fc2f773dde97c67bcfc9830c7</code> - for all
intents and purposes it cannot be inverted. And that is true even when computers
do the hashing at their maximum speeds. If you click the <em>Run SHA256 Automatically</em>
button below then you can have your device cycle through pre-images and show you
the results at its maximum possible speed:</p>
<div class="form-container" id="form2">
    <input type="checkbox" id="inputCheckbox2" checked disabled>
    <label for="inputCheckbox2">automatically increment pre-image after each hash</label>
    <br><br>
    <label for="inputMessage2" class="for-textbox">pre-image</label><br>
    <div class="left">
        <input id="inputMessage2" type="text" value="a" disabled>
    </div>
    <div class="left">
        <button id="btnRunHash2">Run SHA256 Automatically</button>
    </div>
    <br>
    <div class="left">
        <span id="info2" style="display:none;">
            (Average hash rate: <span></span> hashes per second)
        </span>
    </div>
    <br><br>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div id="codeblock2HashResults" class="codeblock">? <span class="aligner"></span>-> SHA256 -> <span id="match2" class="individual-digits">32bd2fb75ea9fdd49c0a9b97b015b47a9cf41f6fc2f773dde97c67bcfc9830c7</span>
<span id="showResults2" style="display:none;"><span id="preImage2"> </span> <span class="aligner"></span>-> SHA256 -> <span id="hash2Result" class="individual-digits"></span>
status: <span id="matchStatus2"></span></span></div>
    </div>
</div>

<p><span id="showHowLongForThisDevice" style="display:none;">Using your device's
average hash rate of <span class="hash2Rate"></span> hashes per second, then we
can calculate that it is going to take <span id="howLongForThisDeviceWords"></span>
to try enough combinations to invert this hash and find the solution. That's
<span id="howLongForThisDeviceNumber"></span>.</span></p>
<p>When it comes hashing, <span class="hash2Rate">30</span> hashes per second is
actually not quick at all by computer standards. Specialized computer chips are
built to run billions of hashes per second. At the time of writing (March 2018)
the total global SHA256 hashpower is 25,000,000,000,000,000,000 hashes per second,
or 25 million million million hashes per second, but even at this rate it would
take 146 million million million million million million million million years
to try all pre-image combinations for SHA256. Thats about a million million
million years quicker than your device, but it doesn't really matter - by the
time it comes around our sun will have long since burned out.</p>
<p>"Ok", you might think to yourself, "but maybe I don't need to try all the
possible combinations to produce the hash I'm after - maybe I can just skip
ahead ... If the pre-image I start with does not give a hash that is close to
what I want, then I will just choose a pre-image further along that gives a hash
closer to what I want, and then make minor adjustments until I zero in on the
hash." But alas, this is not how cryptographic hashing works - Property 4 tells
us that hashes are both deterministic and random. They are deterministic because
a pre-image will always hash to the same value, but that value is random, so
there can be no process of zeroing in. Trying a pre-image that is "further along"
is no better than trying any other different pre-image - they all completely
modify the resulting hash.</p>
<p>Now that we have discussed the properties of cryptographic hashing we can
investigate how it is used in a technique known as <em>proof of work</em>, also known
as <em>mining</em>. <em>Proof of work</em>, as the name implies, is a way for one computer to
prove to another computer that it has completed a certain amount of work. Lets
call the computer doing the work the <em>miner</em>, and the other computer the
<em>examiner</em>. The examiner sets a test for the miner to pass by giving it 3 things:</p>
<ul>
<li>part of a pre-image</li>
<li>a hash value that must be matched (called the target)</li>
<li>the difficulty level of the test</li>
</ul>
<p>The test works like this: the miner takes the pre-image it has been given and
appends a bunch of random data (called a nonce) to the end of it. It then hashes
the whole thing and checks if it matches the target given by the examiner.
However, it does not need to match the entire hash (that would take millions of
years), but rather it just needs to match part of the hash - as specified by the
difficulty level.</p>
<p>That all sounds very complicated, but don't worry, it will be much clearer after
you give it a go. Click the <em>Mine with SHA256</em> button and once you find the
solution try changing the difficulty:</p>
<div class="form-container" id="form3">
    <input type="checkbox" id="inputCheckbox3">
    <label for="inputCheckbox3">mine automatically</label>
    <br><br>
    <div class="left">
        <label for="difficulty3" class="for-select">difficulty</label><br>
        <select id="difficulty3"></select>
    </div>
    <div class="left">
        <label for="inputMessage3Prefix" class="for-textbox">pre-image prefix</label><br>
        <input id="inputMessage3Prefix" type="text" value="" disabled>
    </div>
    <div class="left">
        <label for="inputMessage3" class="for-textbox">pre-image nonce</label><br>
        <input id="inputMessage3" type="text" value="a">
    </div>
    <div class="left">
        <button id="btnRunHash3">Mine manually with SHA256</button>
    </div>
    <br>
    <div class="left">
        <span id="info3" style="display:none;">(Average hash rate: <span></span> hashes per second)</span>
    </div>
    <br><br>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div id="codeblock3HashResults" class="codeblock">SHA256 target: <span class="aligner"></span><span id="match3" class="individual-digits">0000000000000000000000000000000000000000000000000000000000000000</span>
<span id="showResults3" style="display:none;"><span id="preImage3"> </span> -> SHA256 -> <span class="aligner"></span><span id="hash3Result" class="individual-digits"></span>
status: <span id="matchStatus3"></span><span id="mining3Statistics"></span></span></div>
    </div>
</div>

<p>Whenever you pass the test, you can send the nonce back to the examiner and it
can verify that you did indeed pass by running the hash for itself. It will take
you lots of attempts at hashing to pass the test, but it only takes the examiner
a single hash to know whether you passed or failed. This means that you are doing
all the work and the examiner barely does any at all.</p>
<p>As you can see, the higher the difficulty, the more attempts it will take on
average to pass the test. From the results you can also see that there is a
degree of luck involved in mining - sometimes it takes less attempts than
expected and sometimes it takes more. This is because hashing is a random process.</p>
<p>Another thing to note is that the examiner can set the target value without
having to hash a pre-image to get it. The examiner does not need to know the
answer to the test before it gives it to the miner. In this way, mining is
different from a normal school exam. All that matters is that the examiner can
verify the test once the miner submits the nonce as a solution.</p>
<p>The final thing to understand from this section, before we move on to bitcoin
mining, is that the test we have done here - matching a specified number of
characters at the left-hand-side of the target - is just one of many possible
types of proof-of-work test. The only criteria for a good proof-of-work test is
that the examiner must be able to fine-tune the number of attempts it takes the
miner to pass. Here are some other possible proof-of-work tests:</p>
<ul>
<li>matching a specified number of characters at the right-hand-side of the target</li>
<li>matching a specified number of characters anywhere within the target</li>
<li>treat both the target and the mined hash as (hexadecimal) numbers, set the
target to some large number, and mandate that the miner must find a hash lower
than the target</li>
</ul>
<p>That last type of proof-of-work test is the one used in bitcoin mining.</p>
<h2>bitcoin mining</h2>
<p>Now that we have explored hashing and mining in general, we can apply this
knowledge to bitcoin mining.</p>
<blockquote>
<p>Bitcoin mining involves computers competing to find the nonce part of the
pre-image for the hash of the next block in the bitcoin blockchain. The winner
receives bitcoins as a reward.</p>
</blockquote>
<p>That definition contains a couple of new concepts, and once you understand them
then it will make perfect sense:</p>
<ul>
<li>a bitcoin block</li>
<li>the bitcoin blockchain</li>
</ul>
<p>When someone sends some bitcoins to someone else, they begin by opening their
bitcoin wallet (which is a program, app or website running on their device), and
then type in the recipient and the amount of bitcoin they want to send to them.
The bitcoin wallet uses this information to construct a transaction. Here is an
example bitcoin transaction:</p>
<div class="media-container"><div class="media-positioner">
    <div class="btc-transaction-full">
        01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac00000000
    </div>
    <div class="media-caption">example bitcoin transaction</div>
</div></div>

<p>For the purposes of this article, the details of this transaction are not important,
but if you are curious you can view all of this transaction's information <a href="https://blockchain.info/tx/b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082">here</a>. However the only thing you really need to
understand at this point is that a bitcoin transaction is just a string of characters.</p>
<p>Once the wallet software has created the transaction it sends it out over the
internet to all the other bitcoin nodes it can find (a bitcoin node is just a
device running the bitcoin software). You might have expected the transaction to
only be sent to the person who is receiving the bitcoins, but that is not the
case. Infact that person does not even have to have their wallet software
running for the transaction to be processed.</p>
<p>Some of the bitcoin nodes which receive the transaction are bitcoin miners (more
on these later). These miners gather the transactions they receive and put them
into a block:</p>
<div class="media-container"><div class="media-positioner">
    <table class="btc-block-mini">
        <tr><td class="btc-block-header-mini">header</td></tr>
        <tr><td class="btc-transaction-mini">transaction 1</td></tr>
        <tr><td class="btc-transaction-mini">transaction 2</td></tr>
        <tr><td class="btc-transaction-mini">transaction 3</td></tr>
    </table>
    <div class="media-caption">a bitcoin block</div>
</div></div>

<p>A bitcoin block consists of a header, followed by a list of transactions. The
block shown here only has 3 transactions, for simplicity, but blocks containing
thousands of transactions are most common.</p>
<p>Just as bitcoin transactions are a string of characters, so is the block header.
The header contains all the data needed to uniquely identify the block:</p>
<div class="media-container"><div class="media-positioner">
    <table class="btc-header-definition">
        <tr><td class="btc-header-field">version</td></tr>
        <tr><td class="btc-header-field">previous block hash</td></tr>
        <tr><td class="btc-header-field">merkle root</td></tr>
        <tr><td class="btc-header-field">timestamp</td></tr>
        <tr><td class="btc-header-field">difficulty</td></tr>
        <tr><td class="btc-header-field">nonce</td></tr>
    </table>
    <div class="media-caption">the bitcoin block header</div>
</div></div>

<p>Lets look at each of these fields within the block header:</p>
<p>The <em>version</em> is just a number indicating the current version of the bitcoin
protocol.</p>
<p>The <em>previous block hash</em> is where the <em>blockchain</em> concept comes in - the
current block references the previous block so that blocks build upon each other
over time, like so:</p>
<div class="form-container">
    <object id="blockchainSVG" data="/img/bitcoin-blockchain.svg" type="image/svg+xml"></object>
</div>

<div class="media-caption">the bitcoin blockchain</div>

<p>The <em>previous block hash</em> is found by doing a <em>SHA265</em> hash twice in succession
on all the data in the previous block header. As we saw in the hashing section
earlier, that is a very quick thing for a computer to do.</p>
<p>The <em>merkle root</em> is loosely defined as a hash of all transactions contained
within the block. The transaction data is the pre-image and the <em>merkle root</em> is
the hash. This another useful feature of cryptographic hashing - it can be used
to summarise a large amonut of data in a very small amount of data. The
transactions in a block generally take up over 1MB, however the merkle root is
only 32 bytes (64 hexadecimal digits).</p>
<p>The <em>timestamp</em> is the current date and time of the block.</p>
<p>The <em>difficulty</em> is a description of how many attempts, on average, a miner will
need to make to find a solution to the test. As mentioned at the end of the
previous section on hashing, the test in bitcoin mining involves finding a hash
that is lower than a given target. The <em>difficulty</em> value in the block header
specifies what that target value is. The way this works is quite technical and
is not necessary to understand bitcoin mining, however if you are curious I have
included it in the annex (the final section of this article). The basic principle
however is simple - increasing the difficulty lowers the target value so that
miners will have to put in more hashing attempts, and decreasing the difficulty
raises the target value so that miners will have to put in fewer hashing
attempts.</p>
<p>Finally the <em>nonce</em> is something we have already discussed in the section on
hashing. The only difference here is that with bitcoin the nonce is an integer.</p>
<p>OK, lets dive into a practical simulation of bitcoin mining to see how all this
works. Click the <em>mine</em> button a few times and have a look at what this does, both
to the results area and to the nonce in the block header:</p>
<div class="form-container" id="form4">
<div class="media-container"><div class="media-positioner">
    <table class="btc-header-definition">
        <tr><td class="btc-header-field">
            version<br>
            <input id="version4" type="text" class="data-value" size="2" value="1">
        </td></tr>
        <tr><td class="btc-header-field">
            previous block hash<br>
            <input id="prevHash4" type="text" class="data-value" size="64" value="0000000000000000000000000000000000000000000000000000000000000000">
        </td></tr>
        <tr><td class="btc-header-field">
            merkle root<br>
            <input id="merkleRoot4" type="text" class="data-value" size="64" value="4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b">
        </td></tr>
        <tr><td class="btc-header-field">
            timestamp<span id="timestamp4Explanation"></span><br>
            <input id="timestamp4" type="text" class="data-value" size="24" value="03 Jan 2009 18:15:05 GMT">
        </td></tr>
        <tr><td class="btc-header-field">
            difficulty<br>
            <input id="bits4" type="text" class="data-value" size="8" value="1d00ffff">
        </td></tr>
        <tr><td class="btc-header-field">
            nonce<br>
            <input id="nonce4" type="text" class="data-value" size="10" value="0">
        </td></tr>
    </table>
    <div class="media-caption">the bitcoin block header</div>
</div></div>
<ul class="error"></ul>
<button id="btnRunHash4">Mine manually with SHA256</button>
<div class="codeblock-container auto-wrap-on-mobile">
    <div class="button-background">
        <button class="wrap-nowrap" wrapped="false">
            <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
            <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
        </button>
    </div><br>
<div class="codeblock">nonce: <span class="aligner">     </span><span id="nonce4Results">0</span>
target: <span class="aligner">    </span><span id="target4" class="individual-digits"></span>
block hash: <span class="aligner"></span><span id="blockhash4" class="individual-digits"></span>
status: <span class="aligner">    </span><span id="mineStatus4"></span></div>
</div>
</div>

<p>The data in the simulation block header is actually that of the very first
bitcoin block ever. It was mined by Satoshi Nakamoto - the creater(s) of Bitcoin
on the 3rd of January 2009.</p>
<p>As you can see, each mining attempt increments the nonce by 1. To find the block
hash, all of the data in the block header shown here is hashed with SHA256 twice
- i.e. it is all put together in one big string of characters and then hashed
once with SHA256, and then that result is hashed with SHA256 again. There is a
walkthrough of this process in the following annex section, however the details
are really not important in order to understand how bitcoin mining works.</p>
<p>The biggest apparent difference between this mining example and the one in the
previous section on hashing is that the test here involves comparing two
hexadecimal numbers, whereas previously the test involved matching a certain
number of digits from the left-hand-side. However there is a actually a lot of
similarity between these two types of test. Lets forget about hexadecimal
numbers for a moment and just look at some unrelated decimal numbers:</p>
<div class="codeblock">1000000000000
      1000000
</div>

<p>It is obvious that the first number is bigger than the second number - the first
one is longer so clearly it must be bigger. But how about if we zero-pad them so
that they are the same length? They are still the same numbers, but now they are
the same length:</p>
<div class="codeblock">1000000000000
0000001000000
</div>

<p>How can we tell which is bigger? The easiest way is to begin at the
left-hand-side of the number compare the digits:</p>
<div class="codeblock"><span class="individual-digit">1</span>000000000000
<span class="individual-digit">0</span>000001000000
</div>

<p>Because <code>1</code> is greater than <code>0</code> then we know that the first number must be a
bigger number.</p>
<p>OK, now what if we pad them both to 64 digits? Again they are exactly the same
numbers as before, and they are the same length, but now they have lots of
leading zeros:</p>
<div class="codeblock-container auto-wrap-on-mobile">
    <div class="button-background">
        <button class="wrap-nowrap" wrapped="false">
            <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
            <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
        </button>
    </div><br>
    <div class="codeblock">0000000000000000000000000000000000000000000000000001000000000000
0000000000000000000000000000000000000000000000000000000001000000</div>
</div>

<p>The way to tell which is larger is again to begin at the left-hand-side and keep
moving to the right until we find a digit that is different. Then the digit that
is higher belongs to the bigger number:</p>
<div class="codeblock-container auto-wrap-on-mobile">
    <div class="button-background">
        <button class="wrap-nowrap" wrapped="false">
            <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
            <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
        </button>
    </div><br>
    <div class="codeblock"><span class="individual-digits">0000000000000000000000000000000000000000000000000001</span>000000000000
<span class="individual-digits">0000000000000000000000000000000000000000000000000000</span>000001000000</div>
</div>

<p>That's the technique for decimal numbers, and it is exactly the same for
hexadecimal numbers. The only difference is that decimal numbers go from <code>0</code> to
<code>9</code> whereas hexadecimal numbers go from <code>0</code> to <code>f</code>, as you will recall from the
start of this article. If you now go back and mine a few more times in the
previous simulation then the results should make a lot more sense.</p>
<p>So finally we arrive at the end of this article on bitcoin mining. You now know
all about hashing and how hashing is used in bitcoin for mining. There is a bit
more information in the annex to fill in some small gaps, however everything
already covered above is certainly enough to understand what bitcoin mining is
and to get a feel for the amount of effort that it requires even for the fastest
computers on the planet.</p>
<p>All that remains now is to mine a block. We can cheat at this because the above
block was already mined by Satoshi Nakomoto. If we <a href="http://blockchain.info/block-height/0">inspect the blockchain</a> we can see that the correct nonce is
2,083,236,893. <a id="makeBlockPass4">Click here</a> to copy the nonce back into
the previous mining simulation and then click the <em>mine</em> button to see what
happens.</p>
<h2>annex</h2>
<p>This section goes into all the detail skipped above. It is really just intended
for those (such as myself) who like to leave no stone unturned. One thing that
was not previously explained in detail was how the bitcoin block hashes are
derived from the block header. The block header is stored as bytes in the
bitcoin blockchain (1 byte is 2 hex digits). Previously the values for each
field in the block header were shown in formats which are easy for humans to
understand, however conversions must be done to arrive at the storage method
used by bitcoin.</p>
<p>The <em>version</em> is stored in the blockchain as 4 bytes. Try altering the
human-readable <em>version</em> value to see how this changes the value stored in the
blockchain:</p>
<div class="form-container annex" id="form5">
    <label for="version5" class="for-textbox">version</label><br>
    <input id="version5" type="text" class="data-value" size="10" value="1">
    <ul class="error"></ul>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div class="codeblock">convert to hex: <span class="aligner">                 </span><span id="version5Hex"></span>
convert to 4 bytes (big endian): <span class="aligner"></span><span id="version5Bytes"></span>
convert to little endian: <span class="aligner">       </span><span id="version5BytesLE"></span></div>
    </div>
</div>

<p>Note that converting to <a href="https://en.wikipedia.org/wiki/Endianness">little endian</a>
format simply means reversing the bytes.</p>
<p>The <em>timestamp</em> is also stored in the blockchain as 4 bytes. This currently
imposes some restrictions on the permissible date range. Try altering the
human-readable <em>timestamp</em> value to see how this changes the value stored in the
blockchain:</p>
<div class="form-container annex" id="form6">
    <label for="timestamp6" class="for-textbox">timestamp<span id="timestamp6Explanation"></span></label><br>
    <input id="timestamp6" type="text" class="data-value" size="24" value="03 Jan 2009 18:15:05 GMT">
    <ul class="error"></ul>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div class="codeblock">timestamp: <span class="aligner">                                   </span><span id="timestamp6GMT"></span>
convert to unixtime (integer): <span class="aligner">               </span><span id="timestamp6Unixtime"></span>
convert to hex (always 4 bytes - big endian): <span class="aligner"></span><span id="timestamp6Bytes"></span>
convert to little endian: <span class="aligner">                    </span><span id="timestamp6BytesLE"></span></div>
    </div>
</div>

<p>The bitcoin <em>difficulty</em> (generally called <em>bits</em> when expressed in its 4-byte
compact format) is somewhat similar to
<a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic">floating point notation</a>.
<em>Bits</em> are stored in the blockchain, and the <em>target</em> is used as a threshold
during mining:</p>
<div class="form-container annex" id="form7">
    <label for="bits7" class="for-textbox">difficulty</label><br>
    <input id="bits7" type="text" class="data-value" size="8" value="1d00ffff">
    <ul class="error"></ul>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div class="codeblock">difficulty: <span class="aligner">                        </span><span id="difficulty7"></span>
extract the target length (byte 1): <span class="aligner"></span><span id="lenHex7"></span> hex = <span id="len7"></span> decimal
extract the target prefix: <span class="aligner">         </span><span id="msBytes7"></span><span class="preserve-newline">
</span>
set the prefix to the length and <span class="always-one-newline">
</span>zero-pad to 32 bytes to get target: <span class="aligner"></span><span id="target7"></span><span class="preserve-newline">
</span>
convert to bits (little endian): <span class="aligner">   </span><span id="bits7LE"></span></div>
    </div>
</div>

<p>The human readable <em>nonce</em> is stored in the blockchain as 4 little endian bytes:</p>
<div class="form-container annex" id="form8">
    <label for="nonce8" class="for-textbox">nonce</label><br>
    <input id="nonce8" type="text" class="data-value" size="10" value="0">
    <ul class="error"></ul>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div class="codeblock">convert to hex: <span class="aligner">                 </span><span id="nonce8Hex"></span>
convert to 4 bytes (big endian): <span class="aligner"></span><span id="nonce8Bytes"></span>
convert to little endian: <span class="aligner">       </span><span id="nonce8BytesLE"></span></div>
    </div>
</div>

<p>OK, now we can put all this together. Note how each field in the human readable
block header is converted to bytes to be stored in the blockchain, and how these
are concatenated together. The block header is always 80 bytes:</p>
<div class="form-container" id="form9">
<div class="media-container"><div class="media-positioner">
    <table class="btc-header-definition">
        <tr><td class="btc-header-field">
            version<br>
            <input id="version9" type="text" class="data-value" size="2" value="1">
        </td></tr>
        <tr><td class="btc-header-field">
            previous block hash<br>
            <input id="prevHash9" type="text" class="data-value" size="64" value="0000000000000000000000000000000000000000000000000000000000000000">
        </td></tr>
        <tr><td class="btc-header-field">
            merkle root<br>
            <input id="merkleRoot9" type="text" class="data-value" size="64" value="4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b">
        </td></tr>
        <tr><td class="btc-header-field">
            timestamp<span id="timestamp9Explanation"></span><br>
            <input id="timestamp9" type="text" class="data-value" size="24" value="03 Jan 2009 18:15:05 GMT">
        </td></tr>
        <tr><td class="btc-header-field">
            difficulty<br>
            <input id="bits9" type="text" class="data-value" size="8" value="1d00ffff">
        </td></tr>
        <tr><td class="btc-header-field">
            nonce<br>
            <input id="nonce9" type="text" class="data-value" size="10" value="2083236893">
        </td></tr>
    </table>
    <div class="media-caption">the bitcoin block header</div>
</div></div>
<ul  class="error"></ul>
<div class="codeblock-container auto-wrap-on-mobile">
    <div class="button-background">
        <button class="wrap-nowrap" wrapped="false">
            <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
            <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
        </button>
    </div><br>
<div class="codeblock">block header (hex): <span class="aligner">                </span><span id="block9Bytes"><span id="version9Output" class="outputField"></span><span id="prevHash9Output" class="outputField"></span><span id="merkleRoot9Output" class="outputField"></span><span id="timestamp9Output" class="outputField"></span><span id="bits9Output" class="outputField"></span><span id="nonce9Output" class="outputField"></span></span>
block header -> SHA256 -> <span class="aligner">          </span><span id="firstSHA256Output9"></span>
convert to little endian: <span class="aligner">          </span><span id="firstSHA256OutputLE9"></span>
block header -> SHA256 -> SHA256 -> <span class="aligner"></span><span id="secondSHA256Output9"></span>
convert to little endian: <span class="aligner">          </span><span id="secondSHA256OutputLE9"></span></div>
</div>
</div>

<p>If you are very astute you will notice that copying and pasting this block header
into the <em>SHA256</em> hash forms from the start of this article gives a different
result to the <em>SHA256</em> hashes here. This is because these hashes are implemented
with the knowledge that the pre-image is a hexadecimal number, whereas the hashes
in the first section were implemented for a pre-image expressed in bytes. If you
were to convert the ...</p>
<div class="form-container" id="form10">
    <input type="checkbox" id="inputCheckbox10" checked>
    <label for="inputCheckbox10">pre-image is hex</label>
    <br><br>
    <label for="inputMessage10" class="for-textbox">pre-image</label><br>
    <textarea id="inputMessage10">0100000000000000000000000000000000000000000000000000000000000000000000003ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a29ab5f49ffff001d1dac2b7c</textarea>
    <div class="codeblock-container auto-wrap-on-mobile">
        <div class="button-background">
            <button class="wrap-nowrap" wrapped="false">
                <i class="fa fa-level-down fa-rotate-90" aria-hidden="true"></i>
                <i class="fa fa-arrows-h" aria-hidden="true" style="display:none;"></i>
            </button>
        </div><br>
        <div id="hash10Results" class="codeblock">pre-image -> SHA256 -> <span class="aligner">                </span><span id="sha256Output10"></span>
pre-image -> SHA256 (little endian) -> <span class="aligner"></span><span id="sha256OutputLE10"></span></div>
    </div>
</div>

<p>if nonce is not big enough - increment the timestamp by 1 second
luck calculator for hashing bits</p>
                </div><!-- /.entry-content -->
        </article>
</section>
            </div>
        </div>

        <footer class="invisible">
            <address id="about">
                blog by peter miller.
                <br>
                Created with <span class="keep-together"><a href="https://getpelican.com/">Pelican <i class="fa fa-external-link" aria-hidden="true"></i></a></span>,
                <span class="keep-together"><a href="https://www.python.org/">python <i class="fa fa-external-link" aria-hidden="true"></i></a></span>,
                <span class="keep-together"><a href="https://en.wikipedia.org/wiki/JavaScript">JavaScript <i class="fa fa-external-link" aria-hidden="true"></i></a></span>,
                and <span class="keep-together"><a href="http://fontawesome.io/">Font Awesome <i class="fa fa-external-link" aria-hidden="true"></i></a></span>.
                Hosted on <span class="keep-together"><a href="https://github.com/mulllhausen/mulllhausen.github.io">github <i class="fa fa-github"></i></a></span>.
                <br>
                <a href="http://null.place/feeds/all.rss.xml"><i class="fa fa-rss" aria-hidden="true"></i> RSS</a>&nbsp;&nbsp;&nbsp;
                <a href="http://null.place/feeds/all.atom.xml"><i class="fa fa-rss" aria-hidden="true"></i> Atom</a>
            </address>
        </footer>


        <script src="http://null.place/theme/js/polyfills.js"></script>
        <script src="http://null.place/theme/js/utils.js"></script>
        <script src="http://null.place/theme/js/matrix-animation.js"></script>
        <script>
            init_all_matrix_canvases('matrix-text-green', 'matrix-text-white');
            var timeout_id_resize_logo;
            addEvent(window, 'resize', function() {
                // debounce the resize
                clearTimeout(timeout_id_resize_logo);
                timeout_id_resize_logo = setTimeout(function() {
                    init_all_matrix_canvases('matrix-text-green', 'matrix-text-white');
                }, 500);
            });
        </script>

        <script src="https://use.fontawesome.com/95559d6484.js"></script>

        <script src="http://null.place/theme/js/autofooter.js"></script>

        <script src="http://null.place/js/sjcl.min.js"></script>
        <script src="http://null.place/js/btc-mining.js"></script>

    </body>
</html>